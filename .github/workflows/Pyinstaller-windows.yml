name: Package Application with Pyinstaller on Mingw64

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v5
      with:
        submodules: true

    - uses: actions/setup-python@v6
      with:
        python-version: '3.13'

    - name: build and package
      run: |
        python --version
        python -m pip install pyinstaller
        python -m pip install .
        pyinstaller --distpath ./pkg --clean --name osc-cli osc_sdk/sdk.py

    - name: smoke test
      run: |
        ./pkg/osc-cli/osc-cli.exe api ReadRegions | grep api.eu-west-2.outscale.com
